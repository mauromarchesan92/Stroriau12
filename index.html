<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Verifica di storia</title>

  <!-- 1) Carica la SDK v3 di EmailJS -->
  <script
    type="text/javascript"
    src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"
  ></script>

  <!-- 2) Inizializza EmailJS con la tua Public Key -->
  <script type="text/javascript">
    window.onload = function () {
      emailjs.init("lBgGe8Ka7HZQbBgth");
    };
  </script>

  <!-- 3) jsPDF per l’esportazione in PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    .correct { color: green; }
    .incorrect { color: red; }
  </style>
</head>
<body>
  <h1>Verifica di storia</h1>

  <!-- Dati Studente -->
  <label>Nome e Cognome: <input type="text" id="studentName" required></label><br>
  <label>Classe: <input type="text" id="studentClass" required></label><br>
  <label>Data: <input type="date" id="date" required></label><br><br>


 <!-- Domande a scelta multipla -->
 <div class="question">
    <p>1. Quando scoppia la Guerra di Corea?</p>
    <label><input type="radio" name="q1" data-correct="false"> 1945</label>
    <label><input type="radio" name="q1" data-correct="true"> 1950</label>
    <label><input type="radio" name="q1" data-correct="false"> 1953</label>
  </div>
  <div class="question">
    <p>2. In quale anno l’URSS invade l’Ungheria?</p>
    <label><input type="radio" name="q2" data-correct="false"> 1953</label>
    <label><input type="radio" name="q2" data-correct="true"> 1956</label>
    <label><input type="radio" name="q2" data-correct="false"> 1960</label>
  </div>
  <div class="question">
    <p>3. In quale anno viene fondata l’ONU?</p>
    <label><input type="radio" name="q3" data-correct="true"> 1945</label>
    <label><input type="radio" name="q3" data-correct="false"> 1948</label>
    <label><input type="radio" name="q3" data-correct="false"> 1951</label>
  </div>
  <div class="question">
    <p>4. Quando si conclude la Guerra del Vietnam?</p>
    <label><input type="radio" name="q4" data-correct="false"> 1973</label>
    <label><input type="radio" name="q4" data-correct="true"> 1975</label>
    <label><input type="radio" name="q4" data-correct="false"> 1978</label>
  </div>
  <div class="question">
    <p>5. In quale anno viene costruito il Muro di Berlino?</p>
    <label><input type="radio" name="q5" data-correct="false"> 1958</label>
    <label><input type="radio" name="q5" data-correct="true"> 1961</label>
    <label><input type="radio" name="q5" data-correct="false"> 1965</label>
  </div>
  <div class="question">
    <p>6. Il Piano Marshall fu finanziato da:</p>
    <label><input type="radio" name="q6" data-correct="false"> Regno Unito</label>
    <label><input type="radio" name="q6" data-correct="true"> Stati Uniti</label>
    <label><input type="radio" name="q6" data-correct="false"> Unione Sovietica</label>
  </div>
  <div class="question">
    <p>7. La Guerra del Vietnam si concluse con:</p>
    <label><input type="radio" name="q7" data-correct="false"> Vittoria degli Stati Uniti</label>
    <label><input type="radio" name="q7" data-correct="false"> Vittoria del Vietnam del Sud</label>
    <label><input type="radio" name="q7" data-correct="true"> Vittoria del Vietnam del Nord</label>
  </div>
  <div class="question">
    <p>8. La Cina maoista era caratterizzata da:</p>
    <label><input type="radio" name="q8" data-correct="true"> Comunismo e maoismo</label>
    <label><input type="radio" name="q8" data-correct="false"> Consumismo e autoritarismo</label>
    <label><input type="radio" name="q8" data-correct="false"> Pacifismo e internazionalismo</label>
  </div>
  <div class="question">
    <p>9. Uno degli obiettivi principali dell’ONU era:</p>
    <label><input type="radio" name="q9" data-correct="false"> Contrastare la diffusione del comunismo</label>
    <label><input type="radio" name="q9" data-correct="false"> Favorire la ripresa economica</label>
    <label><input type="radio" name="q9" data-correct="true"> Tutelare la pace e i diritti umani</label>
  </div>
  <div class="question">
    <p>10. Nel 1949 il territorio della Germania fu:</p>
    <label><input type="radio" name="q10" data-correct="true"> Diviso in due Stati</label>
    <label><input type="radio" name="q10" data-correct="false"> Posto sotto mandato ONU</label>
    <label><input type="radio" name="q10" data-correct="false"> Occupato interamente dall’URSS</label>
  </div>
  <div class="question">
    <p>11. Nel 1959 a Cuba prese il potere ______ che si alleò con ____.</p>
    <label><input type="radio" name="q11" data-correct="true"> Fidel Castro; i Sovietici</label>
    <label><input type="radio" name="q11" data-correct="false"> Fidel Castro; gli Americani</label>
    <label><input type="radio" name="q11" data-correct="false"> Francisco Franco; i Sovietici</label>
  </div>
  <div class="question">
    <p>12. Dopo il 1944, quale valuta divenne riferimento internazionale?</p>
    <label><input type="radio" name="q12" data-correct="false"> La sterlina britannica</label>
    <label><input type="radio" name="q12" data-correct="true"> Il dollaro statunitense</label>
    <label><input type="radio" name="q12" data-correct="false"> Il rublo sovietico</label>
  </div>
  <div class="question">
    <p>13. Chi guidò l’URSS dopo la morte di Stalin?</p>
    <label><input type="radio" name="q13" data-correct="false"> Lenin</label>
    <label><input type="radio" name="q13" data-correct="true"> Nikita Khrushchev</label>
    <label><input type="radio" name="q13" data-correct="false"> Leonid Breznev</label>
  </div>
  <div class="question">
    <p>14. La NATO è un’alleanza militare di paesi:</p>
    <label><input type="radio" name="q14" data-correct="true"> Paesi occidentali</label>
    <label><input type="radio" name="q14" data-correct="false"> Paesi orientali</label>
    <label><input type="radio" name="q14" data-correct="false"> Paesi non allineati</label>
  </div>
  <div class="question">
    <p>15. Chi fu il leader del movimento per i diritti civili degli Afroamericani negli anni Sessanta?</p>
    <label><input type="radio" name="q15" data-correct="true"> Martin Luther King</label>
    <label><input type="radio" name="q15" data-correct="false"> Malcolm X</label>
    <label><input type="radio" name="q15" data-correct="false"> Nelson Mandela</label>
  </div>
  <div class="question">
    <p>16. Chi fu l’artefice del “Grande balzo in avanti” in Cina?</p>
    <label><input type="radio" name="q16" data-correct="true"> Mao Zedong</label>
    <label><input type="radio" name="q16" data-correct="false"> Deng Xiaoping</label>
    <label><input type="radio" name="q16" data-correct="false"> Zhou Enlai</label>
  </div>
  <div class="question">
    <p>17. La Comunità Economica Europea nacque come alleanza di paesi:</p>
    <label><input type="radio" name="q17" data-correct="true"> Europei</label>
    <label><input type="radio" name="q17" data-correct="false"> Mondiali</label>
    <label><input type="radio" name="q17" data-correct="false"> Asiatici</label>
  </div>
  <div class="question">
    <p>18. In che anno si tenne la Conferenza di Yalta?</p>
    <label><input type="radio" name="q18" data-correct="false"> 1943</label>
    <label><input type="radio" name="q18" data-correct="true"> 1945</label>
    <label><input type="radio" name="q18" data-correct="false"> 1947</label>
  </div>
  <div class="question">
    <p>19. In che anno ebbe luogo la Conferenza di Potsdam?</p>
    <label><input type="radio" name="q19" data-correct="true"> 1945</label>
    <label><input type="radio" name="q19" data-correct="false"> 1946</label>
    <label><input type="radio" name="q19" data-correct="false"> 1948</label>
  </div>
  <div class="question">
    <p>20. Nel referendum del 1946 l’Italia scelse come forma di governo:</p>
    <label><input type="radio" name="q20" data-correct="false"> Monarchia</label>
    <label><input type="radio" name="q20" data-correct="true"> Repubblica</label>
    <label><input type="radio" name="q20" data-correct="false"> Impero</label>
  </div>
  <div class="question">
    <p>21. Chi fu il presidente degli USA durante l’escalation della guerra in Vietnam?</p>
    <label><input type="radio" name="q21" data-correct="false"> John F. Kennedy</label>
    <label><input type="radio" name="q21" data-correct="true"> Lyndon B. Johnson</label>
    <label><input type="radio" name="q21" data-correct="false"> Richard Nixon</label>
  </div>
  <div class="question">
    <p>22. Come si concluse la Guerra di Corea?</p>
    <label><input type="radio" name="q22" data-correct="false"> Vittoria degli USA</label>
    <label><input type="radio" name="q22" data-correct="true"> Armistizio</label>
    <label><input type="radio" name="q22" data-correct="false"> Vittoria della Cina</label>
  </div>
  <div class="question">
    <p>23. Il Patto di Varsavia riuniva paesi:</p>
    <label><input type="radio" name="q23" data-correct="false"> Nato (occidentali)</label>
    <label><input type="radio" name="q23" data-correct="true"> Oriental-sovietici</label>
    <label><input type="radio" name="q23" data-correct="false"> Non allineati</label>
  </div>
  <div class="question">
    <p>24. Negli anni Sessanta la crisi di Cuba del 1962 vide contrapposti _____ e _____.</p>
    <label><input type="radio" name="q24" data-correct="true"> URSS e USA</label>
    <label><input type="radio" name="q24" data-correct="false"> Cina e USA</label>
    <label><input type="radio" name="q24" data-correct="false"> URSS e Cina</label>
  </div>

 <button id="sendBtn">Invia via email</button>
  <button id="checkBtn" disabled>Correggi risposte</button>
  <button id="exportBtn" disabled>Esporta risposte (PDF)</button>

  <script>
  let score = 0;

  function getAllAnswers() {
    const questions = document.querySelectorAll('.question');
    let output = '';
    questions.forEach((q, i) => {
      const text = q.querySelector('p').innerText;
      const sel  = q.querySelector('input[type="radio"]:checked');
      const ans  = sel ? sel.parentElement.innerText.trim() : "Nessuna risposta";
      output += `${i+1}. ${text}\nRisposta: ${ans}\n\n`;
    });
    return output;
  }

  function calculateScore() {
    score = 0;
    document.querySelectorAll('.question').forEach(q => {
      const sel = q.querySelector('input[type="radio"]:checked');
      const cor = q.querySelector('input[data-correct="true"]');
      if (sel === cor) score++;
    });
    return score;
  }

  // 1) INVIO EMAIL: includi anche il punteggio
  document.getElementById("sendBtn").addEventListener("click", function() {
    const name  = document.getElementById("studentName").value.trim();
    const cls   = document.getElementById("studentClass").value.trim();
    const dt    = document.getElementById("date").value;
    const msg   = getAllAnswers();
    const pts   = calculateScore();

    if (!name || !cls || !dt) {
      return alert("Per favore, compila tutti i campi.");
    }
    this.disabled = true;

    emailjs.send("service_7kem7ei","template_4uytzdn",{
      to_name:       "Professor Marchesan",
      to_email:      "mauro.marchesan@icrilke.edu.it",
      from_name:     name,
      student_class: cls,
      date:          dt,
      message:       msg + `Punteggio totale: ${pts} / 24`
    })
    .then(()=>{
      alert("Email inviata con successo!");
      document.getElementById("checkBtn").disabled  = false;
      document.getElementById("exportBtn").disabled = false;
    })
    .catch(e=>{
      alert("Errore nell'invio dell'email: "+ e.text);
      this.disabled = false;
    });
  });

  // 2) CORREZIONE RESTA IDENTICA
  document.getElementById("checkBtn").addEventListener("click", function() {
    document.querySelectorAll('.question').forEach(q => {
      const sel = q.querySelector('input[type="radio"]:checked');
      const cor = q.querySelector('input[data-correct="true"]');
      if (sel === cor) {
        sel.parentElement.classList.add("correct");
      } else {
        if (sel) sel.parentElement.classList.add("incorrect");
        cor.parentElement.classList.add("correct");
      }
    });
    alert(`Hai ottenuto ${calculateScore()} risposte corrette su ${document.querySelectorAll('.question').length}`);
  });

  // 3) ESPORTAZIONE PDF SU PIÙ PAGINE
  document.getElementById("exportBtn").addEventListener("click", function() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    const margin     = 10;
    const lineHeight = 7;
    const pageHeight = doc.internal.pageSize.height;
    let cursorY     = margin;

    const name  = document.getElementById("studentName").value.trim();
    const cls   = document.getElementById("studentClass").value.trim();
    const dt    = document.getElementById("date").value;
    let text = `Verifica di storia\n\nNome: ${name}\nClasse: ${cls}\nData: ${dt}\n\n`;
    text += getAllAnswers();
    text += `Punteggio totale: ${score} / ${document.querySelectorAll('.question').length}\n`;

    // dividi in righe larghezza 180mm
    const lines = doc.splitTextToSize(text, 180);

    lines.forEach(line => {
      if (cursorY > pageHeight - margin) {
        doc.addPage();
        cursorY = margin;
      }
      doc.text(line, margin, cursorY);
      cursorY += lineHeight;
    });

    doc.save('verifica_storia.pdf');
  });
</script>
</body>
</html>
<h1>👋 In bocca al lupo!<h1>
